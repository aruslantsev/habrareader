from sqlite3 import Connection
from habrareader.data.tables import (
    ARTICLE_TBL,
    ARTICLE_CONTENTS_TBL,
    AUTHOR_TBL,
    ARTICLE_STATISTICS_TBL,
    ARTICLE_HUB_TBL,
    ARTICLE_TAG_TBL,
    ARTICLE_FLOW_TBL,
    HUB_TBL,
    FLOW_TBL,
    ARTICLE_COMMENT_TBL,
    COMMENT_CONTENTS_TBL,
    COMMENT_CHILD_TBL,
)


CREATE_ARTICLE_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {ARTICLE_TBL} (
id INTEGER PRIMARY KEY,
time_downloaded INTEGER NOT NULL,
time_published INTEGER,
is_success INTEGER
);
"""

CREATE_ARTICLE_CONTENTS_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {ARTICLE_CONTENTS_TBL} (
id INTEGER PRIMARY KEY,
lang TEXT,
title TEXT NOT NULL,
author_id INTEGER NOT NULL,
text_html TEXT NOT NULL,
lead_data TEXT NOT NULL,
is_corporative INTEGER NOT NULL,
original_url TEXT
);
"""

CREATE_AUTHOR_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {AUTHOR_TBL} (
author_id INTEGER PRIMARY KEY,
alias TEXT NOT NULL,
full_name TEXT
);
"""

CREATE_ARTICLE_STATISTICS_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {ARTICLE_STATISTICS_TBL} (
id INTEGER PRIMARY KEY,
num_comments INTEGER NOT NULL,
num_readings INTEGER NOT NULL,
score INTEGER NOT NULL,
votes INTEGER NOT NULL,
votes_positive INTEGER NOT NULL,
votes_negative INTEGER NOT NULL
);
"""

CREATE_ARTICLE_HUB_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {ARTICLE_HUB_TBL} (
id INTEGER NOT NULL,
hub_id INTEGER NOT NULL
);
"""

CREATE_ARTICLE_TAG_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {ARTICLE_TAG_TBL} (
id INTEGER NOT NULL,
tag_title_html TEXT NOT NULL
);
"""

CREATE_ARTICLE_FLOW_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {ARTICLE_FLOW_TBL} (
id INTEGER NOT NULL,
flow_id INTEGER NOT NULL
);
"""

CREATE_HUB_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {HUB_TBL} (
hub_id INTEGER PRIMARY KEY,
hub_alias TEXT NOT NULL,
hub_type TEXT NOT NULL,
hub_title TEXT NOT NULL,
hub_title_html TEXT NOT NULL
);
"""

CREATE_FLOW_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {FLOW_TBL} (
flow_id INTEGER PRIMARY KEY,
flow_alias TEXT NOT NULL,
flow_title TEXT NOT NULL,
flow_title_html TEXT NOT NULL
);
"""

CREATE_ARTICLE_COMMENT_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {ARTICLE_COMMENT_TBL} (
id INTEGER NOT NULL,
comment_id INTEGER NOT NULL,
time_published INTEGER NOT NULL
);
"""

CREATE_COMMENT_CONTENTS_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {COMMENT_CONTENTS_TBL} (
comment_id INTEGER PRIMARY KEY,
score INTEGER NOT NULL,
votes_count INTEGER NOT NULL,
message TEXT NOT NULL,
author_id INTEGER NOT NULL
);
"""

CREATE_COMMENT_CHILD_TBL_STMT = f"""
CREATE TABLE IF NOT EXISTS {COMMENT_CHILD_TBL} (
comment_id INTEGER PRIMARY KEY,
child_comment_id INTEGER
);
"""


def create_tables(connection: Connection):
    cursor = connection.cursor()
    cursor.execute(CREATE_ARTICLE_TBL_STMT)
    cursor.execute(CREATE_ARTICLE_CONTENTS_TBL_STMT)
    cursor.execute(CREATE_AUTHOR_TBL_STMT)
    cursor.execute(CREATE_ARTICLE_STATISTICS_TBL_STMT)
    cursor.execute(CREATE_ARTICLE_HUB_TBL_STMT)
    cursor.execute(CREATE_ARTICLE_TAG_TBL_STMT)
    cursor.execute(CREATE_ARTICLE_FLOW_TBL_STMT)
    cursor.execute(CREATE_HUB_TBL_STMT)
    cursor.execute(CREATE_FLOW_TBL_STMT)
    cursor.execute(CREATE_ARTICLE_COMMENT_TBL_STMT)
    cursor.execute(CREATE_COMMENT_CONTENTS_TBL_STMT)
    cursor.execute(CREATE_COMMENT_CHILD_TBL_STMT)
